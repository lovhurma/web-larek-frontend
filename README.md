# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных испоьзуемые в приложении 

Карточка Продукта

```

export interface IProduct {
  id: string;
  description?: string;
  image?: string;
  title: string;
  category: string;
  price: number | null
}
```

Модель для хранения данных карточек продуктов

```

export interface IProductData {
  catalog: IProduct[]
  counter: number
}
```
Данные о покупателе

```
export interface IOrderData {
  payment?: string;
  email?: string;
  phone?: string;
  address?: string;
  items?: IProduct[]
}
```

Сумма заказа и список ID купленных товаров в корзине

```

 export interface IOrder {
  totalamount: number
  items: IProduct['id'][]
}
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

### Слой данных

#### Класс ProductModal
Класс отвечает за хранение и логику работы с данными.\
В полях класса хранятся следующие данные:
- items: IProduct[] - Массив объектов со всеми товарами
- order: IOrderData - Информация о заказе при покупке товара

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addproducts(): IProduct[] - Добавление массива карточек
- getBasketAmount() - Метод для получения количества товаров в корзине
- addToBasket(): -  Добавление товара(карточки) в корзину
- removeFromBasket(): - Удаление товара с корзины
- clearBasket(): - Метод для полной очистки корзины
- getBasketPrice(): - Общая сумма(стоимость) товаров в корзине
- getItems(): - Метод для получения списка ID товаров в корзине 
- addOrderField(field: IOrderData, value: string): - Метод для заполнения полей email, phone, address, payment 
- validateContacts(): - Валидация форм для окошка "контакты"
- validateOrder(): - Валидация форм для окошка "заказ"
- cleanOrder(): - Очистка данных покупателя
- isItem(): - Метод для проверки наличия товара в корзине

### Классы представления

#### Класс Modal
Отвечает за отображение модального окна.\
Расширяется базовым абстрактным классом Component<T>
Так же предоставляет методы open и close для управления отображением модального окна, render для отрисовки данных контента, и set сontetnt для  установки контента модального окна. Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- closeButton — разметка кнопки закрытия модального окна
- content — разметка контейнера для контента модального окна

#### Класс Basket
Класс, описывающий корзину товаров\
Расширяется базовым абстрактным классом Component<T>
Предоставляет методы set list — устанавливает товары в разметку, set price — устанавливает значение суммы товаров

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- _list — отображение списка товаров в корзине
- _price — отображение cуммы товаров в корзине
- button — разметка кнопки перехода на шаг оформления заказа

#### Класс Form<T>
Отвечает за основные способы работы с формой и ее валидацию.\
Расширяется базовым абстрактным классом Component<T>
Предоставляет методы onInputChange — регистрирует событие с именем конкретного поля, set valid — метод установки валидности, set errors — метод установки ошибки, render — отрисовка формы и ее элементов

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- _submit — хранит разметку кнопки отправки формы
- _errors — хранит разметку вывода ошибок валидации

#### Класс Order

Отвечает за отображение выбора способо оплаты и адресса покупателя в модальном окне.\
Расширяется классом Form<T> по интерфейсу IOrderData
Предоставляет методы set payment — устанавливает класс активности на кнопку и set address — устанавливает значение поля адрес

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- buttons — хранит разметку кнопок формы оплаты

#### Класс Contacts

Отвечает за отображение контактов покупателя в модальном окне.\
Расширяется классом Form<T> по интерфейсу IOrderData
Предоставляет методы set phone — устанавливает значение поля телефона и set email — устанавливает значение поля почты

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

#### Класс Cards

Отвечает за отображение данных карточки товара в каталоге, в модальном окне отдельной карточки и в каталоге корзины. Поля отвечают за связь с разметкой, методы за наполнение разметки данными.\
Расширяется базовым абстрактным классом Component<T> по интерфейсу IProduct

Предоставляет методы setData(cardData: IProduct) — заполняет атрибуты элементов карточки

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- _id — хранит id карточки
- _description - хранит описание карточки
- _image -  хранит разметку изображения карточки
- _title: -  хранит разметку заголовка карточки
- _category: -  хранит разметку категории карточки
- _price - хранит разметку цены карточки

#### Класс Page

Отвечает за отображение данных составляющих элементов страницы: каталог, корзина, счетчик товаров в корзине\
Расширяется базовым абстрактным классом Component<T> по интерфейсу IProductData
Поля отвечают за связь с разметкой, методы за наполнение разметки данными, а также метод закрытия/открытия для прокрутки страницы при открытии/закрытии модального окна.

Предоставляет методы - set counter - счётчик товаров в корзине, set catalog -   // отображение карточек товаров на странице, set locked -   устанавливает класс, блокирующий прокрутку страницы

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- _counter — хранит рамзетку счетчика товаров в корзине
- _catalog — хранит разметку каталога товаров
- wrapper — хранит разметку обертки страницы
- basket — хранит разметку кнопки корзины