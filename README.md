# Проектная работа "Веб-ларек"

Стек: HTML, SCSS, TS, Webpack

Структура проекта:
- src/ — исходные файлы проекта
- src/components/ — папка с JS компонентами
- src/components/base/ — папка с базовым кодом

Важные файлы:
- src/pages/index.html — HTML-файл главной страницы
- src/types/index.ts — файл с типами
- src/index.ts — точка входа приложения
- src/styles/styles.scss — корневой файл стилей
- src/utils/constants.ts — файл с константами
- src/utils/utils.ts — файл с утилитами

## Установка и запуск
Для установки и запуска проекта необходимо выполнить команды

```
npm install
npm run start
```

или

```
yarn
yarn start
```
## Сборка

```
npm run build
```

или

```
yarn build
```

## Данные и типы данных испоьзуемые в приложении 

Карточка Продукта

```

export interface IProduct {
  id: string;
  description: string;
  image: string;
  title: string;
  category: string;
  price: number | null
}
```

Модель для хранения данных карточек продуктов

```

export interface IProductData {
  catalog: IProduct[]
  counter: number
}
```
Данные о покупателе

```
export interface IOrderData {
  payment?: string;
  email?: string;
  phone?: string;
  address?: string;
}
```

Сумма заказа и список ID купленных товаров в корзине

```

 export interface IOrder {
  totalamount: number
  productListElement: IProduct['id'][]
}
```
## Архитектура приложения

Код приложения разделен на слои согласно парадигме MVP: 
- слой представления, отвечает за отображение данных на странице, 
- слой данных, отвечает за хранение и изменение данных
- презентер, отвечает за связь представления и данных.

### Базовый код

#### Класс Api
Содержит в себе базовую логику отправки запросов. В конструктор передается базовый адрес сервера и опциональный объект с заголовками запросов.
Методы: 
- `get` - выполняет GET запрос на переданный в параметрах ендпоинт и возвращает промис с объектом, которым ответил сервер
- `post` - принимает объект с данными, которые будут переданы в JSON в теле запроса, и отправляет эти данные на ендпоинт переданный как параметр при вызове метода. По умолчанию выполняется `POST` запрос, но метод запроса может быть переопределен заданием третьего параметра при вызове.

#### Класс EventEmitter
Брокер событий позволяет отправлять события и подписываться на события, происходящие в системе. Класс используется в презентере для обработки событий и в слоях приложения для генерации событий.  
Основные методы, реализуемые классом описаны интерфейсом `IEvents`:
- `on` - подписка на событие
- `emit` - инициализация события
- `trigger` - возвращает функцию, при вызове которой инициализируется требуемое в параметрах событие   

Основные генерируемые в приложении события
- items:changed -  Инициируется при изменении списка товаров и вызывает перерисовку списка товаров на странице
- modal:open - Инициируется при клике на кнопку закрытия
- modal:close - Инициируется при клике на кнопку закрытия, клике вне модального окна или по клавше Esc и приводит к закрытю модального окна
- card:selected - Инициируется при клике на карточку товара и получает данные о ней - объект конкретного товара
- card:toBasket - Инициируется при нажатии кнопки "В корзину". Вызывает добавление товара в корзину
- preview:changed - Инициируется при передаче моделью новых данных, оповещает View, приводит к отрисовке содержимого модального окна 
- basket:changed - Инициируется при изменении состояния корзины
card:toBasket - Инциируется при клике на кнопку "В корзину", приводит к добавлении товара в корзину и перерисовке счетчика корзины на главной
- basket:open - Инициируется при клике на значек корзины и приводит к открытию модального окна с выбранными товарами и итоговой ценой
- basket:delete - Инициируется при клике на значек корзины внутри самой корзины, вызывает перерисовку списка товаров и счетчика на главной страничце
- basket:toOrder - Инициируется при клике на кнопку "Оформить" в корзине, приводит к открытию модального окна с выбором способа оплаты и адреса доставки
- order:cash - Инициируется при клике на кнопку способа оплаты онлайн
- order:offline - Инициируется при клике на кнопку способа оплаты при получении
- order:submit - Инициируется при клике на кнопку "Далее". Приводит к открытию модального окна с заполнением контактов
- order:ready - Инициируется при успешном заполнении всех форм. Приводит к снятию блокировки кнопки "Оплатить"
- contacts:submit - Инициируется при клике на кнопку "Оплатить". Приводит к открытию модального окна с сообщением о покупке
- input:change - Инициируется при вводе данных в форму заказа Order и контактов Contacts. Запускает процесс валидации
- input:error -  совершает процесс валидации формы, возвращает ошибки формы
- order:success - Инициируется при успешном ответе сервера при оплате товара. Открывает модальное окно сообщающее об успешной оплате
- 


### Слой данных

#### Класс ProductModel
Класс отвечает за хранение и логику работы с данными.\
В полях класса хранятся следующие данные:
- items: IProduct[] - Массив объектов со всеми товарами
- order: IOrderData - Информация о заказе при покупке товара
- basket: IProduct[] - Массив объектов товаров в корзине

Так же класс предоставляет набор методов для взаимодействия с этими данными.
- addproducts() - Добавление массива карточек
- setPreview() - Превью выбранной карточки
- getBasketAmount() - Метод для получения количества товаров в корзине
- addToBasket() -  Добавление товара(карточки) в корзину
- removeFromBasket() - Удаление товара с корзины
- clearBasket() - Метод для полной очистки корзины
- getBasketPrice() - Общая сумма(стоимость) товаров в корзине
- getItems() - Метод для получения списка ID товаров в корзине 
- addOrderField(field: IOrderData, value: string): - Метод для заполнения полей email, phone, address, payment 
- validateContacts() - Валидация форм для окошка "контакты"
- validateOrder() - Валидация форм для окошка "заказ"
- cleanOrder() - Очистка данных покупателя
- isProductInBasket() - Метод для проверки наличия товара в корзине

### Классы представления

#### Класс Modal
Отвечает за отображение модального окна.\
Рассширяет базовый абстрактный класс Component<T>
Устанавливает слушатели на клавиатуру, для закрытия модального окна по Esc, на клик в оверлей и кнопку-крестик для закрытия попапа.  
constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- closeButton — разметка кнопки закрытия модального окна
- content — разметка контейнера для контента модального окна

Методы класса
- open - открытие модального окна
- close - закрытие модального окна
- render - отрисовка данных контента

#### Класс Basket
Класс, описывающий корзину товаров\
Рассширяет базовый абстрактный класс Component<T>

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- productListElement — блок для отображения списка карточек товаров
- totalElement — отображение cуммы товаров в корзине
- button — элемент для отображения стоимости корзины

Методы класса
- set list — устанавливает товары в разметку
- set price — устанавливает значение суммы товаров

#### Класс Form<T>
Отвечает за основные способы работы с формой и ее валидацию.\
Рассширяет базовый абстрактный класс Component<T>

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- submitButton — хранит разметку кнопки отправки формы
- errorsElements — хранит разметку вывода ошибок валидации

Методы класса
- onInputChange —  регистрирует событие с именем конкретного поля
- set valid — метод установки валидности
- render — отрисовка формы и ее элементов

#### Класс Order

Отвечает за отображение выбора способо оплаты и адресса покупателя в модальном окне.\
Расширяет класс Form<T> по интерфейсу IOrderData

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- buttonsPay — хранит разметку кнопок формы оплаты

Методы класса
- set payment — устанавливает класс активности на кнопку
- set address — устанавливает значение поля адрес

#### Класс Contacts

Отвечает за отображение контактов покупателя в модальном окне.\
Расширяет класс Form<T> по интерфейсу IOrderData

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Методы класса
- set phone — устанавливает значение поля телефона
- set email — устанавливает значение поля почты

#### Класс Success
Класс отвечает за отображение успешной покупки.\
Рассширяет базовый абстрактный класс Component<T>

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- totalAmount — разметка общей суммы товаров в заказе

Методы класса
- set total — установка значения общей суммы

#### Класс Cards

Отвечает за отображение данных карточки товара в каталоге, в модальном окне отдельной карточки и в каталоге корзины. Поля отвечают за связь с разметкой, методы за наполнение разметки данными.\
Рассширяет базовый абстрактный класс Component<T> по интерфейсу IProduct

constructor (container: HTMLElement, action?: ICardAction) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект action типа ICardAction для установки слушателя на кнопку или контейнер

Поля класса
- _description - хранит описание карточки
- _image -  хранит разметку изображения карточки
- _title: -  хранит разметку заголовка карточки
- _category: -  хранит разметку категории карточки
- _price - хранит разметку цены карточки

Методы класса
- set id - устанавливает id карточки
- set price - устанавливает стоимость карточки
- set title - устанавливает заголовок карточки
- set description - устанавливает описание карточки
- set image - устанавливает изображение карточки
- set category - устанавливает категорию карточки

#### Класс Page

Отвечает за отображение данных составляющих элементов страницы: каталог, корзина, счетчик товаров в корзине\
Рассширяет базовый абстрактный класс Component<T> по интерфейсу IProductData
Поля отвечают за связь с разметкой, методы за наполнение разметки данными, а также метод закрытия/открытия для прокрутки страницы при открытии/закрытии модального окна.

constructor (container: HTMLElement, protected events: IEvents) Конструктор принимает container типа HTMLElement, передавая container в родительский конструктор и объект event типа IEvents

Поля класса
- basketCounter — хранит рамзетку счетчика товаров в корзине
- productCatalog — хранит разметку каталога товаров
- wrapper — хранит разметку обертки страницы
- basket — хранит разметку кнопки корзины

Методы класса
- set counter - отображение счётчика товаров в корзине
- set catalog - отображение карточек товаров на странице
- set locked -  устанавливает класс, блокирующий прокрутку страницы